{% set ingress_nginx_hosts = salt['pillar.get']('ingress_nginx_hosts') %}
upstream nginx_ingress_http {
    {% for host in ingress_nginx_hosts %}
    server {{host}}:80 max_fails=2 fail_timeout=3;
    {% endfor %}
}

server {
    listen 80;
    proxy_pass nginx_ingress_http;
    proxy_connect_timeout 2s;
}

upstream nginx_ingress_https {
    {% for host in ingress_nginx_hosts %}
    server {{host}}:443 max_fails=2 fail_timeout=3;
    {% endfor %}
}

server {
    listen 443;
    proxy_pass nginx_ingress_https;
    proxy_connect_timeout 2s;
}
